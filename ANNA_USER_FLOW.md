# Anna AI - Complete User Flow
## From "I'm Spiraling" Click to Victory

---

## Option 1: Direct Protocol (Current)

```
[Home Screen]
    â†“ User clicks "I'm spiraling" button
[Pre-Check Screen]
    â†’ Feeling scale: 1 (struggling) / 3 (anxious) / 5 (okay) / 7 (calm)
    â†“ User selects intensity
[90-Second Protocol]
    â†’ 12 static prompts
    â†’ 5-4-3-2-1 grounding
    â†’ Breathing exercises
    â†“ Protocol completes
[Post-Check Screen]
    â†’ Same feeling scale
    â†’ Shows improvement
    â†“ Optional
[Trigger Selection]
    â†’ Select what caused spiral
    â†“
[Home Screen]
```

**Problem:** No human connection, feels clinical

---

## Option 2: Talk to Anna (NEW)

```
[Home Screen]
    â†“ User clicks "I'm spiraling" button
[Choice Screen] â­ NEW
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  How do you want help?  â”‚
    â”‚                         â”‚
    â”‚  [ğŸ’¬ Talk to Anna]      â”‚ â† Main CTA (larger, top)
    â”‚                         â”‚
    â”‚  [âš¡ Quick Protocol]    â”‚ â† Secondary (smaller, below)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Path A: User Chooses "Talk to Anna"

```
[Choice Screen]
    â†“ User taps "ğŸ’¬ Talk to Anna"
[Connecting Screen]
    â†’ Shows "Connecting to Anna..."
    â†’ Establishes WebSocket
    â†“ (2-3 seconds)
[Anna Conversation Screen]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â† Anna                          â”‚
    â”‚                                  â”‚
    â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â”‚
    â”‚  â”‚ Hi. What's got you  â”‚         â”‚ â† Anna's first message
    â”‚  â”‚ stuck right now?    â”‚         â”‚   (auto-appears)
    â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â”‚
    â”‚                                  â”‚
    â”‚                                  â”‚
    â”‚  [Type a message...]      [â†’]   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User types: "I can't stop thinking about what I said at work"

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â† Anna                          â”‚
    â”‚                                  â”‚
    â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â”‚
    â”‚  â”‚ Hi. What's got you  â”‚         â”‚
    â”‚  â”‚ stuck right now?    â”‚         â”‚
    â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â”‚
    â”‚                                  â”‚
    â”‚           â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â”‚
    â”‚           â”‚ I can't stop     â”‚   â”‚ â† User's message
    â”‚           â”‚ thinking about   â”‚   â”‚
    â”‚           â”‚ what I said at   â”‚   â”‚
    â”‚           â”‚ work             â”‚   â”‚
    â”‚           â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”‚
    â”‚                                  â”‚
    â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â”‚
    â”‚  â”‚ That sounds really  â”‚         â”‚ â† Anna validates
    â”‚  â”‚ tough. Replaying    â”‚         â”‚   (streams in
    â”‚  â”‚ conversations can   â”‚         â”‚    word by word)
    â”‚  â”‚ feel endless.       â”‚         â”‚
    â”‚  â”‚                     â”‚         â”‚
    â”‚  â”‚ How intense is it   â”‚         â”‚
    â”‚  â”‚ feeling right now,  â”‚         â”‚
    â”‚  â”‚ 1-10?               â”‚         â”‚
    â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â”‚
    â”‚                                  â”‚
    â”‚  [Type a message...]      [â†’]   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User types: "8"

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â† Anna                          â”‚
    â”‚                                  â”‚
    â”‚  [Previous messages scroll up]   â”‚
    â”‚                                  â”‚
    â”‚           â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®   â”‚
    â”‚           â”‚ 8                â”‚   â”‚
    â”‚           â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   â”‚
    â”‚                                  â”‚
    â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â”‚
    â”‚  â”‚ 8 is really high.   â”‚         â”‚ â† Anna assesses
    â”‚  â”‚ I'm going to guide  â”‚         â”‚   & decides to
    â”‚  â”‚ you through         â”‚         â”‚   trigger exercise
    â”‚  â”‚ something that can  â”‚         â”‚
    â”‚  â”‚ help. It'll take    â”‚         â”‚
    â”‚  â”‚ about 3 minutes.    â”‚         â”‚
    â”‚  â”‚ Ready?              â”‚         â”‚
    â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â”‚
    â”‚                                  â”‚
    â”‚  [Type a message...]      [â†’]   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User types: "yes" or "ok"

[Anna Conversation Screen]
    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
    â”‚ Perfect. Starting   â”‚ â† Anna confirms
    â”‚ the exercise now... â”‚   then TRIGGERS
    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯   the protocol

    â†“ (Anna calls triggerExercise() tool)
    â†“ WebSocket sends event to mobile app

[Transition Animation] â­ NEW
    â†’ Screen fade/slide transition
    â†’ Shows "Anna's guiding you through this..."
    â†“

[5-4-3-2-1 Protocol Screen]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Anna's Exercise                 â”‚
    â”‚  â”â”â”â”â”â”â”â” 1/12                   â”‚
    â”‚                                  â”‚
    â”‚  Look around and tell me:        â”‚
    â”‚  5 things you can see            â”‚
    â”‚                                  â”‚
    â”‚  [ Type your answer... ]   [â†’]  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User completes 5-4-3-2-1 grounding
    â†“ Then breathing exercises
    â†“ Protocol finishes (~3 minutes)

[Protocol Complete]
    â†’ Shows completion animation
    â†“ Asks for post-feeling score

[Post-Check Screen]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  How are you feeling now?        â”‚
    â”‚                                  â”‚
    â”‚  ğŸ˜°    ğŸ˜Ÿ    ğŸ˜    ğŸ˜Š            â”‚
    â”‚  1     3     5     7             â”‚
    â”‚        â–² (user taps)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User selects: 5 (down from 8)
    â†“ Mobile app sends to backend via WebSocket

[Return to Anna] â­ NEW
    â†’ Auto-navigates back to conversation
    â†“

[Anna Conversation Screen]
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â† Anna                          â”‚
    â”‚                                  â”‚
    â”‚  [Previous messages]             â”‚
    â”‚                                  â”‚
    â”‚  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®         â”‚
    â”‚  â”‚ That's a 3 point    â”‚         â”‚ â† Anna celebrates
    â”‚  â”‚ drop (38% reduction)â”‚         â”‚   the win with
    â”‚  â”‚                     â”‚         â”‚   COUNTERFACTUAL
    â”‚  â”‚ You just avoided    â”‚         â”‚
    â”‚  â”‚ ~45 minutes of      â”‚         â”‚
    â”‚  â”‚ spiraling about whatâ”‚         â”‚
    â”‚  â”‚ you said at work.   â”‚         â”‚
    â”‚  â”‚                     â”‚         â”‚
    â”‚  â”‚ You reclaimed your  â”‚         â”‚
    â”‚  â”‚ afternoon. That's   â”‚         â”‚
    â”‚  â”‚ real progress. ğŸ¯   â”‚         â”‚
    â”‚  â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯         â”‚
    â”‚                                  â”‚
    â”‚  [Close]                         â”‚ â† User can close
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â†“ User taps Close

[Home Screen]
    â†’ Shows "Last spiral interrupted: Just now"
    â†’ Badge unlocked: "First successful interruption"
```

---

### Path B: User Chooses "Quick Protocol"

```
[Choice Screen]
    â†“ User taps "âš¡ Quick Protocol"
[Pre-Check Screen]
    â†’ Same as current flow
    â†’ Goes straight to 90-second protocol
    â†’ No AI conversation
```

---

## Key UX Improvements

### 1. **Choice Empowerment**
User decides if they want connection (Anna) or speed (protocol).

**Why it works:**
- Respects user autonomy
- Accommodates different needs
- Reduces pressure ("I don't feel like talking today")

### 2. **Anna Feels Human**
- Streaming text (appears word-by-word like typing)
- Natural conversation flow (not a chatbot script)
- Validates feelings before jumping to solutions
- Uses contractions ("that's", "I'm") not formal language

### 3. **Seamless Exercise Trigger**
Anna doesn't say "now type /start exercise"â€”she just transitions naturally:
> "Perfect. Starting the exercise now..."

Then the mobile app receives WebSocket event and navigates automatically.

### 4. **Counterfactual Victory**
After protocol, Anna doesn't just say "good job"â€”she shows what they avoided:
> "You just avoided ~45 minutes of spiraling about what you said at work. You reclaimed your afternoon."

**This makes invisible victories visible** (Peter's key insight).

---

## Mobile App Screen Hierarchy

```
app/
â”œâ”€â”€ index.tsx (Home)
â”‚   â””â”€â”€ "I'm spiraling" button
â”‚
â”œâ”€â”€ spiral-choice.tsx â­ NEW
â”‚   â”œâ”€â”€ "Talk to Anna" button â†’ /anna/conversation
â”‚   â””â”€â”€ "Quick Protocol" button â†’ /spiral
â”‚
â”œâ”€â”€ anna/
â”‚   â””â”€â”€ conversation.tsx â­ NEW
â”‚       â”œâ”€â”€ Chat interface
â”‚       â”œâ”€â”€ WebSocket connection
â”‚       â””â”€â”€ Listens for triggerExercise event
â”‚           â†’ Navigates to /spiral with params
â”‚
â””â”€â”€ spiral.tsx (Existing)
    â”œâ”€â”€ Receives params from Anna (preFeelingScore, source)
    â”œâ”€â”€ Runs 5-4-3-2-1 protocol
    â”œâ”€â”€ Gets postFeelingScore
    â””â”€â”€ If source="anna" â†’ Navigate back to /anna/conversation
       Else â†’ Navigate to home
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Mobile App     â”‚
â”‚  (React Native) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ WebSocket (Socket.io)
         â”‚ Auth: Supabase JWT
         â”‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Render Backend     â”‚
â”‚  (Node.js)          â”‚
â”‚                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Anna Agent   â”‚   â”‚
â”‚  â”‚ (Claude SDK) â”‚â”€â”€â”€â”¼â”€â†’ Anthropic API
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   (Claude Sonnet 4.5)
â”‚         â”‚            â”‚
â”‚         â†“            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent Tools  â”‚   â”‚
â”‚  â”‚ â€¢ triggerExerciseâ”‚
â”‚  â”‚ â€¢ saveProgress  â”‚
â”‚  â”‚ â€¢ getHistory    â”‚â”€â”€â”€â”¼â”€â†’ Supabase Database
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   (ai_sessions table)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## What Changes in Existing Code

### Minimal Changes to Existing Files:

1. **`app/spiral.tsx`** (1 small change)
   - Add "Talk to Anna" button at the top
   - Accept `source` param to know if coming from Anna
   - If source="anna", navigate back to conversation after completion

2. **`supabase/schema.sql`** (1 new table)
   - Add `ai_sessions` table
   - No changes to existing tables

3. **`utils/analytics.ts`** (Add events)
   - Add Anna-specific tracking events

### New Files to Create:

1. **`app/spiral-choice.tsx`** - Choice screen
2. **`app/anna/conversation.tsx`** - Chat interface
3. **`components/anna/ChatBubble.tsx`** - Reusable bubble
4. **`components/anna/ChatInput.tsx`** - Reusable input
5. **`hooks/useAnnaChat.ts`** - WebSocket logic
6. **Entire backend folder** - Node.js + Claude SDK

---

## Why This Flow Works

### Psychological Benefits:
1. **Human Connection:** Talking to Anna fulfills need to be heard
2. **Autonomy:** User chooses their path (talk vs quick)
3. **Validation:** Anna acknowledges difficulty before solving
4. **Visible Progress:** Counterfactual shows concrete win

### Technical Benefits:
1. **Non-invasive:** Existing flow still works (quick protocol)
2. **Modular:** Anna is separate feature, can toggle on/off
3. **Scalable:** WebSocket handles real-time, no polling
4. **Measurable:** Can A/B test Anna vs static completion rates

### Business Benefits:
1. **Retention:** Users come back because Anna knows them
2. **Differentiation:** No other spiral app has conversational AI
3. **Data Goldmine:** Learn what triggers spiral most (anonymized)
4. **Upgrade Path:** Premium users get unlimited Anna sessions

---

## Alternative Flows (Future Iterations)

### If User Has Pattern:
```
User: "I'm spiraling again"
Anna: "Welcome back. Work stuff again? That's 3 this week."
      â†“ Shows pattern recognition
      "Want to try the 2-minute version since you know the drill?"
      â†“ Offers fast-track for experienced users
```

### If User Improved Quickly:
```
Anna: "That's a 6-point drop in 3 minutes. You're getting really good at this."
      â†“ Builds self-efficacy
      "What do you think made it work so fast this time?"
      â†“ Helps user internalize their own power
```

### If User Didn't Improve:
```
Anna: "Still at an 8. That's okayâ€”sometimes it takes longer."
      "Want to try the breathing exercise for another minute?"
      â†“ Offers extension without judgment
      "Or we can just talk for a bit?"
      â†“ Flexibility shows it's not a rigid protocol
```

---

## Comparison: Static vs Anna

| Aspect | Static Protocol | With Anna |
|--------|----------------|-----------|
| **Time** | 90 seconds | 5-8 minutes (talk + exercise) |
| **Feels like** | Following instructions | Talking to a friend |
| **Personalization** | None | Remembers patterns, adapts tone |
| **Victory moment** | "Good job" | "You avoided 45 min of spiraling" |
| **Return likelihood** | Low (no relationship) | High (Anna knows them) |
| **Cost** | $0 | ~$0.025/session |

---

Ready to build this? Should I start with:
1. Creating the backend (Anna's brain)
2. Creating the mobile UI (chat interface)
3. Or both in parallel with agents?

Let me know! ğŸš€
